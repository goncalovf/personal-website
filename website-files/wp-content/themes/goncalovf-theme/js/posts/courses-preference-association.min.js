function createBubbleChart(){function t(){l=PARAM.chart_dim.width-PARAM.margins.left-PARAM.margins.right,d=PARAM.chart_dim.height-PARAM.margins.top-PARAM.margins.bottom,u=d3.select(".chart").attr("width",PARAM.chart_dim.width).attr("height",PARAM.chart_dim.height)}function e(t){var e=t.map(function(t){return _={ref:t.ref,id:t[PARAM.node_attr.id],scaled_radius:h(+t[PARAM.node_attr.radius]),actual_radius:+t[PARAM.node_attr.radius],fill_color_group:t[PARAM.node_attr.fill_color],course:t.rel_name},_});return e}function a(){m=r(),i(m);var t=d3.extent(m,function(t){return+t[PARAM.node_attr.radius]})[1];h=d3.scaleLinear().range([PARAM.radiusScale_range.min,PARAM.radiusScale_range.max]).domain([0,t]),A=e(m),n()}function r(){var t=g.filter(function(t){return t.ref_name===s});return t.sort(function(t,e){return parseFloat(e.points)-parseFloat(t.points)}),t.slice(0,30)}function i(t){var e=d3.map(t,function(t){return t[PARAM.node_attr.fill_color]}).keys(),a=u.selectAll(".legend_rect").data(e);a.exit().remove(),a.enter().append("rect").attr("class","legend_rect").attr("x",PARAM.margins.left+l-18).attr("transform",function(t,e){return"translate(0,"+(20*e+PARAM.margins.top)+")"}).attr("width",18).attr("height",18).merge(a).style("fill",function(t){return f(t)});var r=u.selectAll(".legend_text").data(e);r.exit().remove(),r.enter().append("text").attr("class","legend_text").attr("x",PARAM.margins.left+l-24).attr("transform",function(t,e){return"translate(0,"+(20*e+PARAM.margins.top)+")"}).attr("y",9).attr("dy",".35em").style("text-anchor","end").merge(r).text(function(t){return t})}function n(){e&&e.stop(),p=u.selectAll(".bubble").data(A);var t=p.enter().append("circle").attr("class","bubble").attr("stroke-width",1).on("mouseover",function(t){d3.select(this).attr("stroke-width",2),M.transition().duration(200).style("opacity",1),M.html(t.course+'<br><a href="http://www.dges.gov.pt/guias/indcurso.asp?curso='+t.id+'" target="_blank">Ver no guia de cursos</a> <i class="fas fa-external-link-alt"></i>').attr("class","tooltip").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY+5+"px")}).on("mouseout",function(){d3.select(this).attr("stroke-width",1),d3.selectAll("div.tooltip").transition().delay(1500).duration(200).style("opacity",0)});p=p.merge(t).attr("r",0).attr("fill",function(t){return f(t.fill_color_group)}).attr("stroke",function(t){return d3.rgb(f(t.fill_color_group)).darker()}),p.exit().remove(),p.transition().duration(2e3).attr("r",function(t){return t.scaled_radius});var e=d3.forceSimulation().nodes(A).velocityDecay(.3).on("tick",o).force("charge",d3.forceManyBody().strength(+PARAM.force_strength)).force("center",d3.forceCenter(l/2,d/2+PARAM.chart_dim.height_shift)).force("collision",d3.forceCollide().radius(function(t){return t.scaled_radius}))}function o(){p.each(function(t){}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}function c(){s=v.val()||[],a()}var s,l,d,u,h,f,g,m,_,A,p,M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),v=jQuery("#menu select[name=ref]").select2().on("change",c),P=function(e){g=e,d3.select("#menu select[name=ref]").selectAll("option").data(d3.map(e,function(t){return t.ref_name}).keys()).enter().append("option").attr("value",function(t){return t}).text(function(t){return t});var r=["Arquitetura","Biologia","Bioquímica","Biotecnologia","Ciências Biomédicas Laboratoriais","Ciências da Comunicação","Ciências do Desporto","Contabilidade","Economia","Educação Básica","Educação Social","Enfermagem","Engenharia Biomédica","Engenharia Civil","Engenharia do Ambiente","Engenharia e Gestão Industrial","Engenharia Eletrotécnica e de Computadores","Engenharia Física","Engenharia Informática","Engenharia Mecânica","Engenharia Química","Farmácia","Fisioterapia","Geologia","Gestão","Gestão de Empresas","História","Imagem Médica e Radioterapia","Línguas, Literaturas e Culturas","Marketing","Matemática","Medicina","Psicologia","Serviço Social","Sociologia","Solicitadoria","Turismo"];s=r[Math.floor(Math.random()*r.length)],v.val(s),f=d3.scaleOrdinal(d3.schemeCategory10).domain(d3.map(e,function(t){return t[PARAM.node_attr.fill_color]}).keys()),t(),a()};return P}var char_dim_width,height_shift;screen.width<800?(char_dim_width=screen.width,height_shift=75):(char_dim_width=688,height_shift=25);var PARAM={data_location:"/wp-content/themes/goncalovf-theme/content/post-data/courses-preference-association.csv",report_title:"Associação de cursos nas preferências dos alunos, 1ª fase, 2017",footer_text:"Fonte: DGES.",margins:{top:20,right:30,bottom:50,left:50},chart_dim:{width:char_dim_width,height:520,height_shift:height_shift},node_attr:{id:"rel",radius:"points",fill_color:"rel_bagg"},radiusScale_range:{min:2,max:75},force_strength:15};window.onload=function(){var t=createBubbleChart();d3.csv(PARAM.data_location).then(function(e){t(e)})};