window.onload=function(){function t(t){return t.Admission_grade_2017=+t.Admission_grade_2017,t.Admission_grade_avg=+t.Admission_grade_avg,t}function e(){i=h.val()||[],r()}function a(){s=v.val(),c="Admission_grade_2017"===s?"2017":"média entre 2017-2015",p.select(".title").text("Média de ingresso por curso em cada instituição pública, 1ª fase, "+c),r()}function r(){function t(t){d3.selectAll(".dot").each(e(t.alpha)),d3.selectAll(".dot").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}function e(t){return function(e){e.x+=.1*(g(e.Course)-e.x)*t,e.y+=.1*(m(e[s])-e.y)*t}}g.domain(i),d3.transition(p).select(".x.axis").call(f);var a=g.rangeBand(),r=p.selectAll(".dot").data(o.filter(function(t){return i.includes(t.Course)})).attr("cx",function(t){return g(t.Course)}).attr("cy",function(t){return m(t[s])}).style("fill",function(t){return t.color}).attr("transform","translate("+(l.left+a/2)+", "+l.top+")");r.exit().remove(),r.enter().append("circle").attr("class","dot").attr("r",4).attr("cx",function(t){return g(t.Course)}).attr("cy",function(t){return m(t[s])}).style("fill",function(t){return t.color}).attr("transform","translate("+(l.left+a/2)+", "+l.top+")").on("mouseover",function(t){_.transition().duration(200).style("opacity",1),_.html(t.Inst_fullname+"<br>Nota de ingresso 2017: "+t.Admission_grade_2017+"<br>Nota de ingresso (média 2017-2015): "+t.Admission_grade_avg+'<br><a href="http://www.dges.gov.pt/guias/detcursopi.asp?codc='+t.Course_code+"&code="+t.Inst_code+'" target="_blank">Ver no guia de cursos</a> <i class="fas fa-external-link-alt"></i>').attr("class","tooltip").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){d3.selectAll("div.tooltip").transition().delay(1500).duration(200).style("opacity",0)}),p.selectAll(".tick text").call(n,a);var c=d3.layout.force().nodes(o.filter(function(t){return i.includes(t.Course)})).size([d,u]).on("tick",t).charge(-1).gravity(0).chargeDistance(20);c.start(),p.selectAll(".y.axis tspan").attr("x",-10)}function n(t,e){t.each(function(){for(var t,a=d3.select(this),r=a.text().split(/\s+/).reverse(),n=[],o=0,i=1.1,s=a.attr("y"),c=parseFloat(a.attr("dy")),l=a.text(null).append("tspan").attr("x",0).attr("y",s).attr("dy",c+"em");t=r.pop();)n.push(t),l.text(n.join(" ")),l.node().getComputedTextLength()>e&&(n.pop(),l.text(n.join(" ")),n=[t],l=a.append("tspan").attr("x",0).attr("y",s).attr("dy",++o*i+c+"em").text(t))})}var o,i,s,c,l={top:20,right:30,bottom:50,left:60},d=688-l.left-l.right,u=520-l.top-l.bottom,p=d3.select(".chart").attr("width",d+l.left+l.right).attr("height",u+l.top+l.bottom),g=d3.scale.ordinal().rangeBands([0,d],.1,.1),f=d3.svg.axis().scale(g).orient("bottom");p.append("g").attr("class","x axis").attr("transform","translate("+l.left+", "+(u+l.top)+")").call(f).append("text").attr("dy","-.71em").attr("x",d).attr("dx",-6).style("text-anchor","end").text("Cursos");var m=d3.scale.linear().range([u,0]).domain([95,200]),x=d3.svg.axis().scale(m).orient("left");p.append("g").attr("class","y axis").call(x).attr("transform","translate("+l.left+", "+l.top+")").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Média de ingresso");var y=d3.scale.category10(),h=jQuery("#menu select[name=course]");h.select2(),h.on("change",e);var v=jQuery("#menu select[name=grade]");v.on("change",a);var _=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);p.append("text").attr("class","source").attr("x",l.left+d).attr("y",l.top+u+l.bottom).attr("text-anchor","end").style("font-size","10px").text("Fonte: DGES"),d3.csv("/wp-content/themes/goncalovf-theme/content/post-data/courses-college-admission-grade.csv",t,function(t){o=t,o.forEach(function(t){t.color=y(t.Academic_level)});var e=d3.select("#menu select");e.selectAll("option").data(d3.map(o,function(t){return t.Course}).keys()).enter().append("option").text(function(t){return t});var a=p.selectAll(".legend").data(y.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+(20*e+l.top)+")"});a.append("rect").attr("x",l.left+d-18).attr("width",18).attr("height",18).style("fill",y),a.append("text").attr("x",l.left+d-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t});var n=["Arquitetura","Biologia","Bioquímica","Biotecnologia","Ciências Biomédicas Laboratoriais","Ciências da Comunicação","Ciências do Desporto","Contabilidade","Economia","Educação Básica","Educação Social","Enfermagem","Engenharia Biomédica","Engenharia Civil","Engenharia do Ambiente","Engenharia e Gestão Industrial","Engenharia Eletrotécnica e de Computadores","Engenharia Física","Engenharia Informática","Engenharia Mecânica","Engenharia Química","Farmácia","Fisioterapia","Geologia","Gestão","Gestão de Empresas","História","Imagem Médica e Radioterapia","Línguas, Literaturas e Culturas","Marketing","Matemática","Medicina","Psicologia","Serviço Social","Sociologia","Solicitadoria","Turismo"],u=n.sort(()=>.5-Math.random());i=u.slice(0,5).sort(),h.val(i),s="Admission_grade_2017",c="2017",p.append("text").attr("class","title").attr("x",l.left+d/2).attr("y",l.top).attr("text-anchor","middle").style("font-size","16px").style("font-weight","bold").text("Média de ingresso por curso em cada instituição pública, 1ª fase, "+c),r()})};